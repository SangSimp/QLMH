@page
@model IndexModel
@{
    ViewData["Title"] = "Trang chủ";
}

@if (!string.IsNullOrEmpty(Model.Message))
{
    <div class="container px-4 px-lg-5">
        <div class="alert alert-success mt-3" role="alert">
            @Model.Message
        </div>
    </div>
}

<header class="py-4">
    <div class="container px-4 px-lg-5">

        <div class="rounded-3 shadow-lg overflow-hidden">

            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3" aria-label="Slide 4"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="4" aria-label="Slide 5"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="/images/banner_1.png" class="d-block w-100 carousel-img-height" alt="Figure Shop Banner 1">
                        <div class="carousel-caption d-none d-md-block hero-text-overlay">
                            <h1>FIGURE SHOP</h1>
                            <p>Chào mừng đến với thế giới của những mô hình đỉnh cao!</p>
                            <a asp-page="/Index" asp-route-SearchString="Naruto" class="btn btn-warning btn-lg mt-3">Khám phá ngay</a>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="/images/banner_2.png" class="d-block w-100 carousel-img-height" alt="Figure Shop Banner 2">
                        <div class="carousel-caption d-none d-md-block hero-text-overlay">
                            <h1>FIGURE SHOP</h1>
                            <p>Chào mừng đến với thế giới của những mô hình đỉnh cao!</p>
                            <a asp-page="/Index" asp-route-SearchString="Naruto" class="btn btn-warning btn-lg mt-3">Khám phá ngay</a>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="/images/banner_3.png" class="d-block w-100 carousel-img-height" alt="Figure Shop Banner 3">
                        <div class="carousel-caption d-none d-md-block hero-text-overlay">
                            <h1>FIGURE SHOP</h1>
                            <p>Chào mừng đến với thế giới của những mô hình đỉnh cao!</p>
                            <a asp-page="/Index" asp-route-SearchString="Naruto" class="btn btn-warning btn-lg mt-3">Khám phá ngay</a>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="/images/banner_4.png" class="d-block w-100 carousel-img-height" alt="Figure Shop Banner 4">
                        <div class="carousel-caption d-none d-md-block hero-text-overlay">
                            <h1>FIGURE SHOP</h1>
                            <p>Chào mừng đến với thế giới của những mô hình đỉnh cao!</p>
                            <a asp-page="/Index" asp-route-SearchString="Naruto" class="btn btn-warning btn-lg mt-3">Khám phá ngay</a>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="/images/banner_5.png" class="d-block w-100 carousel-img-height" alt="Figure Shop Banner 5">
                        <div class="carousel-caption d-none d-md-block hero-text-overlay">
                            <h1>FIGURE SHOP</h1>
                            <p>Chào mừng đến với thế giới của những mô hình đỉnh cao!</p>
                            <a asp-page="/Index" asp-route-SearchString="Naruto" class="btn btn-warning btn-lg mt-3">Khám phá ngay</a>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>
</header>
<section class="py-5">
    <div class="container px-4 px-lg-5 mt-5">

        <div class="text-center mb-5" id="productListAnchor">
            <h2 class="fw-bolder">@Model.PageTitle</h2>
            <hr class="w-25 mx-auto" />
        </div>

        @if (Model.Products.Any())
        {
            <div class="row gx-4 gx-lg-5 row-cols-1 row-cols-md-3 row-cols-xl-4 justify-content-center">

                @foreach (var item in Model.Products)
                {
                    <div class="col mb-5">
                        <div class="card h-100">
                            @if (item.SalePrice != null && item.SalePrice > 0)
                            {
                                <div class="sale-badge">SALE</div>
                            }
                            <img class="card-img-top" src="@(string.IsNullOrEmpty(item.ImageUrl) ? "https://dummyimage.com/450x300/dee2e6/6c757d.jpg" : item.ImageUrl)" alt="@item.Name" />
                            <div class="card-body p-4 text-center">
                                <h5 class="fw-bolder">@item.Name</h5>
                                <div class="d-flex justify-content-center small text-warning mb-2">
                                    @if (item.Reviews != null && item.Reviews.Any())
                                    {
                                        var averageRating = item.Reviews.Average(r => r.Rating);
                                        for (int i = 1; i <= 5; i++)
                                        {
                                            <div class="bi-star@(i <= averageRating ? "-fill" : "")"></div>
                                        }
                                        <span class="text-muted ms-1">(@item.Reviews.Count)</span>
                                    }
                                    else
                                    {
                                        <span class="text-muted ms-1">(Chưa có đánh giá)</span>
                                    }
                                </div>
                                @if (item.SalePrice != null && item.SalePrice > 0)
                                {
                                    <span class="product-price-old">@($"{item.Price:N0} VNĐ")</span>
                                    <span class="product-price-new">@($"{item.SalePrice.Value:N0} VNĐ")</span>
                                }
                                else
                                {
                                    <span class="product-price-regular">@($"{item.Price:N0} VNĐ")</span>
                                }
                            </div>
                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent text-center">
                                <a class="btn btn-outline-teal mt-auto" asp-page="/ProductDetail" asp-route-id="@item.Id">
                                    Xem chi tiết
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>

            @if (Model.TotalPages > 1)
            {
                @if (Model.TotalPages > 1)
                {
                    <nav aria-label="Page navigation" class="mt-5">
                        <ul class="pagination justify-content-center">

                            <li class="page-item @(Model.PageNum == 1 ? "disabled" : "")">
                                <a class="page-link" asp-page="/Index" asp-route-PageNum="1"
                                   asp-route-SearchString="@Model.SearchString" asp-route-CategoryId="@Model.CategoryId"
                                   asp-fragment="productListAnchor">
                                    <span aria-hidden="true">&laquo;&laquo;</span>
                                </a>
                            </li>

                            <li class="page-item @(Model.PageNum == 1 ? "disabled" : "")">
                                <a class="page-link" asp-page="/Index" asp-route-PageNum="@(Model.PageNum - 1)"
                                   asp-route-SearchString="@Model.SearchString" asp-route-CategoryId="@Model.CategoryId"
                                   asp-fragment="productListAnchor">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>

                            @for (int i = 1; i <= Model.TotalPages; i++)
                            {
                                <li class="page-item @(i == Model.PageNum ? "active" : "")">
                                    <a class="page-link" asp-page="/Index" asp-route-PageNum="@i"
                                       asp-route-SearchString="@Model.SearchString" asp-route-CategoryId="@Model.CategoryId"
                                       asp-fragment="productListAnchor">@i</a>
                                </li>
                            }

                            <li class="page-item @(Model.PageNum == Model.TotalPages ? "disabled" : "")">
                                <a class="page-link" asp-page="/Index" asp-route-PageNum="@(Model.PageNum + 1)"
                                   asp-route-SearchString="@Model.SearchString" asp-route-CategoryId="@Model.CategoryId"
                                   asp-fragment="productListAnchor">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>

                            <li class="page-item @(Model.PageNum == Model.TotalPages ? "disabled" : "")">
                                <a class="page-link" asp-page="/Index" asp-route-PageNum="@Model.TotalPages"
                                   asp-route-SearchString="@Model.SearchString" asp-route-CategoryId="@Model.CategoryId"
                                   asp-fragment="productListAnchor">
                                    <span aria-hidden="true">&raquo;&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                }
            }
        }
        else
        {
            <div class="text-center">
                <p class="lead" style="font-size: 1.5rem;">Không tìm thấy sản phẩm nào phù hợp.</p>
                <a asp-page="/Index" class="btn btn-outline-teal btn-lg mt-3">
                    <i class="bi-arrow-left"></i>
                    Quay về trang chủ
                </a>
            </div>
        }
    </div>
</section>