@page
@model QLMH.Pages.Admin.Orders.IndexModel
@{
    ViewData["Title"] = "Quản lý Đơn hàng";
}

<h1>Quản lý Đơn hàng</h1>

<div class="card mb-4 shadow-sm">
    <div class="card-header bg-light">
        <i class="fas fa-file-invoice-dollar me-1"></i>
        Danh sách đơn hàng
    </div>
    <div class="card-body">
        <table class="table table-bordered table-hover">
            <thead class="table-light">
                <tr>
                    <th>Mã ĐH</th>
                    <th>Khách hàng</th>
                    <th>Địa chỉ giao hàng</th>
                    <th>Ngày đặt</th>
                    <th>Tổng tiền</th>
                    <th class="text-center">Trạng thái</th>
                    <th style="width: 150px;" class="text-center">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Order)
                {
                    <tr>
                        <td class="align-middle fw-bold text-primary">#@item.Id</td>
                        <td class="align-middle">
                            @(string.IsNullOrEmpty(item.FullName) ? (item.User != null ? item.User.FullName : "Khách vãng lai") : item.FullName)
                            <br />
                            <small class="text-muted">@item.PhoneNumber</small>
                        </td>
                        <td class="align-middle text-break" style="max-width: 200px;">
                            @item.ShippingAddress
                        </td>
                        <td class="align-middle">@item.OrderDate.ToString("dd/MM/yyyy HH:mm")</td>
                        <td class="align-middle fw-bold text-success">@item.TotalAmount.ToString("N0") đ</td>

                        <td class="align-middle text-center">
                            @switch (item.OrderStatus)
                            {
                                case "Pending":
                                    <span class="badge bg-warning text-dark">Chờ xử lý</span>
                                    break;
                                case "Approved":
                                    <span class="badge bg-primary">Đã duyệt</span>
                                    break;
                                case "Shipping":
                                    <span class="badge bg-info text-dark">Đang giao</span>
                                    break;
                                case "Completed":
                                    <span class="badge bg-success">Hoàn thành</span>
                                    break;
                                case "Cancelled":
                                    <span class="badge bg-danger">Đã hủy</span>
                                    break;
                                default:
                                    <span class="badge bg-secondary">@item.OrderStatus</span>
                                    break;
                            }
                        </td>

                        <td class="align-middle text-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                    Xử lý
                                </button>

                                <ul class="dropdown-menu">
                                    <li>
                                        <form method="post" asp-page-handler="UpdateStatus" asp-route-id="@item.Id" asp-route-status="Approved">
                                            <button class="dropdown-item text-primary" type="submit">
                                                <i class="fas fa-check me-2"></i>Duyệt đơn
                                            </button>
                                        </form>
                                    </li>

                                    <li>
                                        <form method="post" asp-page-handler="UpdateStatus" asp-route-id="@item.Id" asp-route-status="Shipping">
                                            <button class="dropdown-item text-info" type="submit">
                                                <i class="fas fa-truck me-2"></i>Đang giao hàng
                                            </button>
                                        </form>
                                    </li>

                                    <li>
                                        <form method="post" asp-page-handler="UpdateStatus" asp-route-id="@item.Id" asp-route-status="Completed">
                                            <button class="dropdown-item text-success" type="submit">
                                                <i class="fas fa-check-double me-2"></i>Đã xong
                                            </button>
                                        </form>
                                    </li>

                                    <li><hr class="dropdown-divider"></li>

                                    <li>
                                        <form method="post" asp-page-handler="UpdateStatus" asp-route-id="@item.Id" asp-route-status="Cancelled">
                                            <button class="dropdown-item text-danger" type="submit" onclick="return confirm('Bạn có chắc muốn hủy đơn hàng này?');">
                                                <i class="fas fa-ban me-2"></i>Hủy đơn
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                            </div>

                            <a asp-page="./Details" asp-route-id="@item.Id" class="btn btn-info btn-sm text-white ms-1" title="Chi tiết">
                                <i class="fas fa-eye"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>